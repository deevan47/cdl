{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/comment.service\";\nimport * as i2 from \"../../services/auth.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nfunction CommentsComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10);\n    i0.ɵɵelement(1, \"div\", 11);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CommentsComponent_div_10_img_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 22);\n  }\n  if (rf & 2) {\n    const comment_r3 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵproperty(\"src\", comment_r3.user.avatar, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction CommentsComponent_div_10_span_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"uppercase\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const comment_r3 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 1, comment_r3.user == null ? null : comment_r3.user.name == null ? null : comment_r3.user.name.charAt(0)));\n  }\n}\nfunction CommentsComponent_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 12)(1, \"div\", 13)(2, \"div\", 14)(3, \"div\", 15);\n    i0.ɵɵtemplate(4, CommentsComponent_div_10_img_4_Template, 1, 1, \"img\", 16);\n    i0.ɵɵtemplate(5, CommentsComponent_div_10_span_5_Template, 3, 3, \"span\", 17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 18)(7, \"span\", 19);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"span\", 20);\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"date\");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(12, \"p\", 21);\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const comment_r3 = ctx.$implicit;\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", comment_r3.user == null ? null : comment_r3.user.avatar);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !(comment_r3.user == null ? null : comment_r3.user.avatar));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(comment_r3.user == null ? null : comment_r3.user.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(11, 5, comment_r3.createdAt, \"medium\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(comment_r3.content);\n  }\n}\nfunction CommentsComponent_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 23);\n    i0.ɵɵtext(1, \" No comments yet. Be the first to start the discussion! \");\n    i0.ɵɵelementEnd();\n  }\n}\nlet CommentsComponent = /*#__PURE__*/(() => {\n  class CommentsComponent {\n    commentService;\n    authService;\n    projectId;\n    comments = [];\n    newCommentText = '';\n    currentUser = null;\n    loading = false;\n    constructor(commentService, authService) {\n      this.commentService = commentService;\n      this.authService = authService;\n      const user = this.authService.currentUserValue;\n      this.currentUser = user?.user ? user.user : user;\n    }\n    ngOnInit() {\n      if (this.projectId) {\n        this.loadComments();\n      }\n    }\n    ngOnChanges(changes) {\n      if (changes['projectId'] && !changes['projectId'].firstChange) {\n        this.loadComments();\n      }\n    }\n    loadComments() {\n      if (!this.projectId) return;\n      this.loading = true;\n      this.commentService.getComments(this.projectId).subscribe({\n        next: comments => {\n          this.comments = comments;\n          this.loading = false;\n        },\n        error: err => {\n          console.error('Error loading comments:', err);\n          this.loading = false;\n        }\n      });\n    }\n    addComment() {\n      if (!this.newCommentText.trim() || !this.projectId) return;\n      this.commentService.createComment(this.projectId, this.newCommentText).subscribe({\n        next: comment => {\n          // The backend returns the comment with the user relation populated\n          // But just in case, we can ensure the current user is attached for immediate display\n          if (!comment.user && this.currentUser) {\n            comment.user = this.currentUser;\n          }\n          this.comments.unshift(comment);\n          this.newCommentText = '';\n        },\n        error: err => console.error('Error adding comment:', err)\n      });\n    }\n    static ɵfac = function CommentsComponent_Factory(t) {\n      return new (t || CommentsComponent)(i0.ɵɵdirectiveInject(i1.CommentService), i0.ɵɵdirectiveInject(i2.AuthService));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: CommentsComponent,\n      selectors: [[\"app-comments\"]],\n      inputs: {\n        projectId: \"projectId\"\n      },\n      features: [i0.ɵɵNgOnChangesFeature],\n      decls: 12,\n      vars: 5,\n      consts: [[1, \"mt-8\"], [1, \"text-lg\", \"font-semibold\", \"text-gray-800\", \"dark:text-white\", \"mb-4\"], [1, \"bg-white\", \"dark:bg-gray-800\", \"p-4\", \"rounded-lg\", \"shadow\", \"mb-6\"], [\"rows\", \"3\", \"placeholder\", \"Write a comment...\", 1, \"w-full\", \"p-3\", \"border\", \"border-gray-300\", \"dark:border-gray-600\", \"rounded-md\", \"bg-gray-50\", \"dark:bg-gray-700\", \"text-gray-800\", \"dark:text-white\", \"focus:ring-2\", \"focus:ring-blue-500\", \"focus:outline-none\", 3, \"ngModel\", \"ngModelChange\"], [1, \"flex\", \"justify-end\", \"items-center\", \"mt-3\"], [1, \"px-4\", \"py-2\", \"bg-blue-600\", \"text-white\", \"rounded-md\", \"hover:bg-blue-700\", \"disabled:opacity-50\", \"transition\", 3, \"disabled\", \"click\"], [1, \"space-y-4\"], [\"class\", \"text-center py-4\", 4, \"ngIf\"], [\"class\", \"p-4 rounded-lg border-l-4 bg-white dark:bg-gray-800 border-blue-500 shadow-sm\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"text-center text-gray-500 italic\", 4, \"ngIf\"], [1, \"text-center\", \"py-4\"], [1, \"inline-block\", \"animate-spin\", \"rounded-full\", \"h-8\", \"w-8\", \"border-b-2\", \"border-blue-600\"], [1, \"p-4\", \"rounded-lg\", \"border-l-4\", \"bg-white\", \"dark:bg-gray-800\", \"border-blue-500\", \"shadow-sm\"], [1, \"flex\", \"justify-between\", \"items-start\", \"mb-2\"], [1, \"flex\", \"items-center\", \"gap-2\"], [1, \"w-8\", \"h-8\", \"rounded-full\", \"bg-blue-500\", \"flex\", \"items-center\", \"justify-center\", \"text-xs\", \"font-bold\", \"text-white\", \"overflow-hidden\"], [\"class\", \"w-full h-full object-cover\", 3, \"src\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"flex\", \"flex-col\"], [1, \"font-semibold\", \"text-sm\", \"text-gray-800\", \"dark:text-gray-200\"], [1, \"text-xs\", \"text-gray-500\"], [1, \"text-sm\", \"whitespace-pre-wrap\", \"text-gray-700\", \"dark:text-gray-300\", \"mt-2\"], [1, \"w-full\", \"h-full\", \"object-cover\", 3, \"src\"], [1, \"text-center\", \"text-gray-500\", \"italic\"]],\n      template: function CommentsComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"h3\", 1);\n          i0.ɵɵtext(2, \"Project Discussion\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(3, \"div\", 2)(4, \"textarea\", 3);\n          i0.ɵɵlistener(\"ngModelChange\", function CommentsComponent_Template_textarea_ngModelChange_4_listener($event) {\n            return ctx.newCommentText = $event;\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(5, \"div\", 4)(6, \"button\", 5);\n          i0.ɵɵlistener(\"click\", function CommentsComponent_Template_button_click_6_listener() {\n            return ctx.addComment();\n          });\n          i0.ɵɵtext(7, \" Post Comment \");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(8, \"div\", 6);\n          i0.ɵɵtemplate(9, CommentsComponent_div_9_Template, 2, 0, \"div\", 7);\n          i0.ɵɵtemplate(10, CommentsComponent_div_10_Template, 14, 8, \"div\", 8);\n          i0.ɵɵtemplate(11, CommentsComponent_div_11_Template, 2, 0, \"div\", 9);\n          i0.ɵɵelementEnd()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngModel\", ctx.newCommentText);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"disabled\", !ctx.newCommentText.trim());\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngIf\", ctx.loading);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngForOf\", ctx.comments);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", !ctx.loading && ctx.comments.length === 0);\n        }\n      },\n      dependencies: [i3.NgForOf, i3.NgIf, i4.DefaultValueAccessor, i4.NgControlStatus, i4.NgModel, i3.UpperCasePipe, i3.DatePipe]\n    });\n  }\n  return CommentsComponent;\n})();\nexport { CommentsComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}