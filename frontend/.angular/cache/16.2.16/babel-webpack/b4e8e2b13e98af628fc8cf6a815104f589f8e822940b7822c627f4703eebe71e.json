{"ast":null,"code":"import _asyncToGenerator from \"/home/deevan/cdl-project-management-system/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate, __param } from \"tslib\";\nimport { Injectable, NotFoundException } from '@nestjs/common';\nimport { InjectRepository } from '@nestjs/typeorm';\nimport { Task } from './entities/task.entity';\nlet TasksService = class TasksService {\n  taskRepository;\n  constructor(taskRepository) {\n    this.taskRepository = taskRepository;\n  }\n  // --- THIS IS THE NEW METHOD WITH THE DATABASE LOGIC ---\n  findTasksByUserId(userId) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      // This query finds all tasks where the 'assignedTeamMembers' relationship\n      // contains a user with the matching ID.\n      return _this.taskRepository.find({\n        where: {\n          assignedTeamMembers: {\n            id: userId\n          }\n        },\n        relations: ['stage', 'stage.project'],\n        order: {\n          endDate: 'ASC' // Order by the nearest deadline\n        }\n      });\n    })();\n  }\n\n  create(createTaskDto) {\n    const task = this.taskRepository.create(createTaskDto);\n    return this.taskRepository.save(task);\n  }\n  findAll() {\n    return this.taskRepository.find({\n      relations: ['stage']\n    });\n  }\n  findOne(id) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      const task = yield _this2.taskRepository.findOne({\n        where: {\n          id\n        },\n        relations: ['stage', 'assignedTeamMembers']\n      });\n      if (!task) {\n        throw new NotFoundException(`Task with ID \"${id}\" not found`);\n      }\n      return task;\n    })();\n  }\n  update(id, updateTaskDto) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      const task = yield _this3.taskRepository.preload({\n        id: id,\n        ...updateTaskDto\n      });\n      if (!task) {\n        throw new NotFoundException(`Task with ID \"${id}\" not found`);\n      }\n      return _this3.taskRepository.save(task);\n    })();\n  }\n  remove(id) {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      const task = yield _this4.findOne(id);\n      return _this4.taskRepository.remove(task);\n    })();\n  }\n};\nTasksService = __decorate([Injectable(), __param(0, InjectRepository(Task))], TasksService);\nexport { TasksService };","map":{"version":3,"names":["Injectable","NotFoundException","InjectRepository","Task","TasksService","taskRepository","constructor","findTasksByUserId","userId","_this","_asyncToGenerator","find","where","assignedTeamMembers","id","relations","order","endDate","create","createTaskDto","task","save","findAll","findOne","_this2","update","updateTaskDto","_this3","preload","remove","_this4","__decorate","__param"],"sources":["/home/deevan/cdl-project-management-system/frontend/src/app/shared/services/task.service.ts"],"sourcesContent":["import { Injectable, NotFoundException } from '@nestjs/common';\nimport { InjectRepository } from '@nestjs/typeorm';\nimport { Repository } from 'typeorm';\nimport { Task } from './entities/task.entity';\nimport { CreateTaskDto } from './dto/create-task.dto';\nimport { UpdateTaskDto } from './dto/update-task.dto';\n\n@Injectable()\nexport class TasksService {\n  constructor(\n    @InjectRepository(Task)\n    private readonly taskRepository: Repository<Task>,\n  ) {}\n\n  // --- THIS IS THE NEW METHOD WITH THE DATABASE LOGIC ---\n  async findTasksByUserId(userId: string): Promise<Task[]> {\n    // This query finds all tasks where the 'assignedTeamMembers' relationship\n    // contains a user with the matching ID.\n    return this.taskRepository.find({\n      where: {\n        assignedTeamMembers: {\n          id: userId,\n        },\n      },\n      relations: ['stage', 'stage.project'], // Also load related stage and project info\n      order: {\n        endDate: 'ASC', // Order by the nearest deadline\n      },\n    });\n  }\n\n  create(createTaskDto: CreateTaskDto) {\n    const task = this.taskRepository.create(createTaskDto);\n    return this.taskRepository.save(task);\n  }\n\n  findAll() {\n    return this.taskRepository.find({ relations: ['stage'] });\n  }\n\n  async findOne(id: string) {\n    const task = await this.taskRepository.findOne({ where: { id }, relations: ['stage', 'assignedTeamMembers'] });\n    if (!task) {\n      throw new NotFoundException(`Task with ID \"${id}\" not found`);\n    }\n    return task;\n  }\n\n  async update(id: string, updateTaskDto: UpdateTaskDto) {\n    const task = await this.taskRepository.preload({\n      id: id,\n      ...updateTaskDto,\n    });\n    if (!task) {\n      throw new NotFoundException(`Task with ID \"${id}\" not found`);\n    }\n    return this.taskRepository.save(task);\n  }\n\n  async remove(id: string) {\n    const task = await this.findOne(id);\n    return this.taskRepository.remove(task);\n  }\n}"],"mappings":";;AAAA,SAASA,UAAU,EAAEC,iBAAiB,QAAQ,gBAAgB;AAC9D,SAASC,gBAAgB,QAAQ,iBAAiB;AAElD,SAASC,IAAI,QAAQ,wBAAwB;AAK7C,IAAaC,YAAY,GAAzB,MAAaA,YAAY;EAGJC,cAAA;EAFnBC,YAEmBD,cAAgC;IAAhC,KAAAA,cAAc,GAAdA,cAAc;EAC9B;EAEH;EACME,iBAAiBA,CAACC,MAAc;IAAA,IAAAC,KAAA;IAAA,OAAAC,iBAAA;MACpC;MACA;MACA,OAAOD,KAAI,CAACJ,cAAc,CAACM,IAAI,CAAC;QAC9BC,KAAK,EAAE;UACLC,mBAAmB,EAAE;YACnBC,EAAE,EAAEN;;SAEP;QACDO,SAAS,EAAE,CAAC,OAAO,EAAE,eAAe,CAAC;QACrCC,KAAK,EAAE;UACLC,OAAO,EAAE,KAAK,CAAE;;OAEnB,CAAC;IAAC;EACL;;EAEAC,MAAMA,CAACC,aAA4B;IACjC,MAAMC,IAAI,GAAG,IAAI,CAACf,cAAc,CAACa,MAAM,CAACC,aAAa,CAAC;IACtD,OAAO,IAAI,CAACd,cAAc,CAACgB,IAAI,CAACD,IAAI,CAAC;EACvC;EAEAE,OAAOA,CAAA;IACL,OAAO,IAAI,CAACjB,cAAc,CAACM,IAAI,CAAC;MAAEI,SAAS,EAAE,CAAC,OAAO;IAAC,CAAE,CAAC;EAC3D;EAEMQ,OAAOA,CAACT,EAAU;IAAA,IAAAU,MAAA;IAAA,OAAAd,iBAAA;MACtB,MAAMU,IAAI,SAASI,MAAI,CAACnB,cAAc,CAACkB,OAAO,CAAC;QAAEX,KAAK,EAAE;UAAEE;QAAE,CAAE;QAAEC,SAAS,EAAE,CAAC,OAAO,EAAE,qBAAqB;MAAC,CAAE,CAAC;MAC9G,IAAI,CAACK,IAAI,EAAE;QACT,MAAM,IAAInB,iBAAiB,CAAC,iBAAiBa,EAAE,aAAa,CAAC;;MAE/D,OAAOM,IAAI;IAAC;EACd;EAEMK,MAAMA,CAACX,EAAU,EAAEY,aAA4B;IAAA,IAAAC,MAAA;IAAA,OAAAjB,iBAAA;MACnD,MAAMU,IAAI,SAASO,MAAI,CAACtB,cAAc,CAACuB,OAAO,CAAC;QAC7Cd,EAAE,EAAEA,EAAE;QACN,GAAGY;OACJ,CAAC;MACF,IAAI,CAACN,IAAI,EAAE;QACT,MAAM,IAAInB,iBAAiB,CAAC,iBAAiBa,EAAE,aAAa,CAAC;;MAE/D,OAAOa,MAAI,CAACtB,cAAc,CAACgB,IAAI,CAACD,IAAI,CAAC;IAAC;EACxC;EAEMS,MAAMA,CAACf,EAAU;IAAA,IAAAgB,MAAA;IAAA,OAAApB,iBAAA;MACrB,MAAMU,IAAI,SAASU,MAAI,CAACP,OAAO,CAACT,EAAE,CAAC;MACnC,OAAOgB,MAAI,CAACzB,cAAc,CAACwB,MAAM,CAACT,IAAI,CAAC;IAAC;EAC1C;CACD;AAvDYhB,YAAY,GAAA2B,UAAA,EADxB/B,UAAU,EAAE,EAGRgC,OAAA,IAAA9B,gBAAgB,CAACC,IAAI,CAAC,E,EAFdC,YAAY,CAuDxB;SAvDYA,YAAY","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}