{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { ProjectStatus } from '../../shared/models/project.model';\nlet UserDashboardComponent = class UserDashboardComponent {\n  sanitizer;\n  projectService;\n  router;\n  authService;\n  // State variables\n  isDarkMode = false;\n  currentView = 'home';\n  // Data\n  currentUser = null;\n  allProjects = [];\n  managedProjects = [];\n  assignedProjects = [];\n  selectedProject = null;\n  // Assignment UI\n  availableUsers = [];\n  showAssignmentModal = false;\n  selectedStageForAssignment = null;\n  selectedUsersForAssignment = [];\n  // Icons\n  ICONS_SVG = {\n    home: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5\"><path d=\"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\"></path><polyline points=\"9 22 9 12 15 12 15 22\"></polyline></svg>`,\n    user: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5\"><path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"></path><circle cx=\"12\" cy=\"7\" r=\"4\"></circle></svg>`,\n    settings: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5\"><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06-.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"></path></svg>`,\n    bell: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5\"><path d=\"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9\"></path><path d=\"M13.73 21a2 2 0 0 1-3.46 0\"></path></svg>`,\n    message: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5\"><path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path></svg>`,\n    logout: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5\"><path d=\"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4\"></path><polyline points=\"16 17 21 12 16 7\"></polyline><line x1=\"21\" y1=\"12\" x2=\"9\" y2=\"12\"></line></svg>`,\n    sun: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5\"><circle cx=\"12\" cy=\"12\" r=\"5\"></circle><line x1=\"12\" y1=\"1\" x2=\"12\" y2=\"3\"></line><line x1=\"12\" y1=\"21\" x2=\"12\" y2=\"23\"></line><line x1=\"4.22\" y1=\"4.22\" x2=\"5.64\" y2=\"5.64\"></line><line x1=\"18.36\" y1=\"18.36\" x2=\"19.78\" y2=\"19.78\"></line><line x1=\"1\" y1=\"12\" x2=\"3\" y2=\"12\"></line><line x1=\"21\" y1=\"12\" x2=\"23\" y2=\"12\"></line><line x1=\"4.22\" y1=\"19.78\" x2=\"5.64\" y2=\"18.36\"></line><line x1=\"18.36\" y1=\"5.64\" x2=\"19.78\" y2=\"4.22\"></line></svg>`,\n    moon: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5\"><path d=\"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z\"></path></svg>`,\n    chevronLeft: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-6 h-6 text-gray-600 dark:text-gray-300\"><polyline points=\"15 18 9 12 15 6\"></polyline></svg>`,\n    chevronRight: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-6 h-6 text-gray-600 dark:text-gray-300\"><polyline points=\"9 18 15 12 9 6\"></polyline></svg>`,\n    chevronDown: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5 text-gray-500\"><polyline points=\"6 9 12 15 18 9\"></polyline></svg>`\n  };\n  constructor(sanitizer, projectService, router, authService) {\n    this.sanitizer = sanitizer;\n    this.projectService = projectService;\n    this.router = router;\n    this.authService = authService;\n  }\n  logout() {\n    this.authService.logout();\n    this.router.navigateByUrl('/auth/login');\n  }\n  ngOnInit() {\n    this.loadUser();\n    this.loadProjects();\n    this.loadAvailableUsers();\n  }\n  loadUser() {\n    this.authService.currentUser.subscribe(user => {\n      if (user) {\n        this.currentUser = user;\n      } else {\n        this.router.navigate(['/auth/login']);\n      }\n    });\n  }\n  loadProjects() {\n    if (!this.currentUser) return;\n    // Fetch ALL projects for transparency as requested\n    this.projectService.getAllProjectsForDashboard().subscribe({\n      next: projects => {\n        this.allProjects = projects;\n        this.splitProjects();\n        this.calculateAllProjectsHealth();\n      },\n      error: err => console.error('Failed to load projects', err)\n    });\n  }\n  loadAvailableUsers() {\n    this.projectService.getAvailableManagers().subscribe({\n      next: users => {\n        this.availableUsers = users;\n        console.log('Loaded available users for assignment:', this.availableUsers.length);\n      },\n      error: err => console.error('Failed to load users', err)\n    });\n  }\n  splitProjects() {\n    if (!this.currentUser) {\n      console.warn('splitProjects: No currentUser found');\n      return;\n    }\n    console.log('splitProjects: Current User:', this.currentUser.id, this.currentUser.name, this.currentUser.role);\n    console.log('splitProjects: All Projects:', this.allProjects.length);\n    // Managed Projects: Where user is the Project Manager\n    this.managedProjects = this.allProjects.filter(p => {\n      const isManager = p.projectManager?.id === this.currentUser?.id;\n      if (isManager) console.log(`Project ${p.name} is MANAGED by user`);\n      return isManager;\n    });\n    // Assigned Projects: Where user is assigned to stages or tasks (but not PM)\n    this.assignedProjects = this.allProjects.filter(p => {\n      if (p.projectManager?.id === this.currentUser?.id) return false; // Skip if PM\n      // Check if assigned to any stage\n      const assignedToStage = p.stages?.some(s => s.assignedTeamMembers?.some(u => u.id === this.currentUser?.id));\n      // Check if assigned to any task\n      const assignedToTask = p.stages?.some(s => s.tasks?.some(t => t.assignedTeamMembers?.some(u => u.id === this.currentUser?.id)));\n      const isAssigned = assignedToStage || assignedToTask;\n      if (isAssigned) console.log(`Project ${p.name} is ASSIGNED to user`);\n      return isAssigned;\n    });\n    console.log('Managed Projects Count:', this.managedProjects.length);\n    console.log('Assigned Projects Count:', this.assignedProjects.length);\n  }\n  // --- UI Actions ---\n  getIcon(name) {\n    return this.sanitizer.bypassSecurityTrustHtml(this.ICONS_SVG[name] || '');\n  }\n  navigateTo(view, projectId) {\n    if (projectId) {\n      this.router.navigate(['/projects', projectId]);\n      return;\n    }\n    this.currentView = view;\n  }\n  selectProject(project) {\n    this.selectedProject = project;\n  }\n  toggleDarkMode() {\n    this.isDarkMode = !this.isDarkMode;\n    if (this.isDarkMode) {\n      document.documentElement.classList.add('dark');\n    } else {\n      document.documentElement.classList.remove('dark');\n    }\n  }\n  // --- Task Creation UI ---\n  showTaskCreationModal = false;\n  selectedStageForTask = null;\n  newTaskName = '';\n  newTaskStartDate = '';\n  newTaskEndDate = '';\n  openTaskCreationModal(stage) {\n    this.selectedStageForTask = stage;\n    this.newTaskName = '';\n    this.newTaskStartDate = '';\n    this.newTaskEndDate = '';\n    this.showTaskCreationModal = true;\n  }\n  closeTaskCreationModal() {\n    this.showTaskCreationModal = false;\n    this.selectedStageForTask = null;\n  }\n  createTask() {\n    if (!this.selectedStageForTask || !this.newTaskName || !this.newTaskStartDate || !this.newTaskEndDate) return;\n    const taskData = {\n      name: this.newTaskName,\n      startDate: new Date(this.newTaskStartDate),\n      endDate: new Date(this.newTaskEndDate),\n      isCompleted: false\n    };\n    this.projectService.addTaskToStage(this.selectedStageForTask.id, taskData).subscribe({\n      next: task => {\n        // Refresh project\n        this.loadProjects();\n        this.closeTaskCreationModal();\n      },\n      error: err => console.error('Failed to create task', err)\n    });\n  }\n  // --- Task Toggle ---\n  toggleTask(task) {\n    if (!this.canToggleTask(task)) return;\n    const updates = {\n      isCompleted: !task.isCompleted\n    };\n    this.projectService.updateTask(task.id, updates).subscribe({\n      next: updatedTask => {\n        task.isCompleted = updatedTask.isCompleted;\n        this.calculateAllProjectsHealth();\n      },\n      error: err => {\n        console.error('Failed to update task', err);\n        // Revert if failed\n        task.isCompleted = !task.isCompleted;\n      }\n    });\n  }\n  canToggleTask(task) {\n    // PM can always toggle\n    if (this.selectedProject?.projectManager?.id === this.currentUser?.id) return true;\n    // Find stage for this task\n    const stage = this.selectedProject?.stages?.find(s => s.tasks?.some(t => t.id === task.id));\n    if (!stage) return false;\n    // Check if stage is locked\n    if (this.isStageLocked(stage)) return false;\n    // Assigned users can toggle\n    return stage.assignedTeamMembers?.some(u => u.id === this.currentUser?.id);\n  }\n  toggleStageSection(stage) {\n    if (this.isStageLocked(stage)) return;\n    stage.isOpen = !stage.isOpen;\n  }\n  isStageLocked(stage) {\n    if (!this.selectedProject || !this.selectedProject.stages) return false;\n    const index = this.selectedProject.stages.findIndex(s => s.id === stage.id);\n    if (index <= 0) return false; // First stage always unlocked\n    // Check previous stage\n    const prevStage = this.selectedProject.stages[index - 1];\n    // Ideally check status, but for now check if all tasks are completed\n    // Or use the status from backend if reliable\n    // Let's use a simple check: is previous stage completed?\n    // If backend status is COMPLETED, then yes.\n    // If not, check tasks manually\n    if (prevStage['status']?.label === 'Completed') return false;\n    // Manual check\n    if (!prevStage.tasks || prevStage.tasks.length === 0) return false; // If no tasks, assume done? Or blocked? Let's say unlocked if empty for now to avoid deadlocks\n    const allCompleted = prevStage.tasks.every(t => t.isCompleted);\n    return !allCompleted;\n  }\n  getFilteredProjects(platform) {\n    return this.allProjects.filter(p => p.platform === platform);\n  }\n  getStats() {\n    return {\n      total: this.allProjects.length,\n      completed: this.allProjects.filter(p => p.status === ProjectStatus.COMPLETED).length,\n      inProgress: this.allProjects.filter(p => p.status === ProjectStatus.IN_PROGRESS).length,\n      lagging: this.allProjects.filter(p => p.status === ProjectStatus.LAGGING).length\n    };\n  }\n  // --- Assignment Logic ---\n  openAssignmentModal(stage) {\n    this.selectedStageForAssignment = stage;\n    this.selectedUsersForAssignment = stage.assignedTeamMembers?.map(u => u.id) || [];\n    this.showAssignmentModal = true;\n  }\n  closeAssignmentModal() {\n    this.showAssignmentModal = false;\n    this.selectedStageForAssignment = null;\n    this.selectedUsersForAssignment = [];\n  }\n  toggleUserSelection(userId) {\n    const index = this.selectedUsersForAssignment.indexOf(userId);\n    if (index > -1) {\n      this.selectedUsersForAssignment.splice(index, 1);\n    } else {\n      this.selectedUsersForAssignment.push(userId);\n    }\n  }\n  saveAssignments() {\n    if (!this.selectedStageForAssignment) return;\n    this.projectService.assignUsersToStage(this.selectedStageForAssignment.id, this.selectedUsersForAssignment).subscribe({\n      next: updatedStage => {\n        // Update local state\n        const stageIndex = this.selectedProject?.stages?.findIndex(s => s.id === updatedStage.id);\n        if (this.selectedProject && stageIndex !== undefined && stageIndex > -1) {\n          // Refresh project to get full user objects\n          this.loadProjects();\n        }\n        this.closeAssignmentModal();\n      },\n      error: err => console.error('Failed to assign users', err)\n    });\n  }\n  isUserAssigned(userId) {\n    return this.selectedUsersForAssignment.includes(userId);\n  }\n  canEditStage(stage) {\n    if (!this.currentUser) return false;\n    // PM can always edit\n    if (this.selectedProject?.projectManager?.id === this.currentUser.id) return true;\n    return false; // Only PM can edit structure (add tasks, assign users)\n  }\n  // --- Helpers ---\n  getTaskStatus(task) {\n    const endDate = new Date(task.endDate);\n    const today = new Date();\n    if (task.isCompleted) return {\n      label: 'Completed',\n      color: 'green'\n    };\n    if (endDate < today) return {\n      label: 'Overdue',\n      color: 'red'\n    };\n    const sevenDaysFromNow = new Date();\n    sevenDaysFromNow.setDate(today.getDate() + 7);\n    if (endDate <= sevenDaysFromNow) return {\n      label: 'At-Risk',\n      color: 'yellow'\n    };\n    return {\n      label: 'On Track',\n      color: 'green'\n    };\n  }\n  calculateAllProjectsHealth() {\n    // Use backend values if available, or calculate locally\n    // For now, relying on backend 'overallProgress' and 'status'\n    this.allProjects.forEach(p => {\n      // Map backend status to UI colors\n      let color = 'blue';\n      if (p.status === ProjectStatus.COMPLETED) color = 'green';\n      if (p.status === ProjectStatus.LAGGING) color = 'red';\n      if (p.status === ProjectStatus.AT_RISK) color = 'yellow';\n      p['overallStatus'] = {\n        label: p.status,\n        color\n      };\n      // Stage status\n      p.stages?.forEach(stage => {\n        let sColor = 'blue';\n        // map stage status...\n        // Check tasks\n        if (stage.tasks && stage.tasks.length > 0) {\n          const allDone = stage.tasks.every(t => t.isCompleted);\n          if (allDone) {\n            stage['status'] = {\n              label: 'Completed',\n              color: 'green'\n            };\n          } else {\n            stage['status'] = {\n              label: 'In Progress',\n              color: 'blue'\n            };\n          }\n        } else {\n          stage['status'] = {\n            label: 'Pending',\n            color: 'gray'\n          };\n        }\n      });\n    });\n  }\n  getStatusBadgeClass(color) {\n    const classes = {\n      green: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300',\n      yellow: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300',\n      red: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300',\n      blue: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300',\n      gray: 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300'\n    };\n    return `px-2.5 py-0.5 text-xs font-medium rounded-full ${classes[color || 'blue']}`;\n  }\n  getProgressBarColorClass(color) {\n    const classes = {\n      green: 'bg-green-500',\n      yellow: 'bg-yellow-500',\n      red: 'bg-red-500',\n      blue: 'bg-blue-500',\n      gray: 'bg-gray-500'\n    };\n    return classes[color || 'blue'];\n  }\n  getUserAvatar(user) {\n    return user?.avatar || 'assets/default-avatar.png';\n  }\n  getUserName(user) {\n    return user?.name || 'Unknown';\n  }\n};\nUserDashboardComponent = __decorate([Component({\n  selector: 'app-user-dashboard',\n  templateUrl: './user-dashboard.component.html',\n  styleUrls: ['./user-dashboard.component.css']\n})], UserDashboardComponent);\nexport { UserDashboardComponent };","map":{"version":3,"names":["Component","ProjectStatus","UserDashboardComponent","sanitizer","projectService","router","authService","isDarkMode","currentView","currentUser","allProjects","managedProjects","assignedProjects","selectedProject","availableUsers","showAssignmentModal","selectedStageForAssignment","selectedUsersForAssignment","ICONS_SVG","home","user","settings","bell","message","logout","sun","moon","chevronLeft","chevronRight","chevronDown","constructor","navigateByUrl","ngOnInit","loadUser","loadProjects","loadAvailableUsers","subscribe","navigate","getAllProjectsForDashboard","next","projects","splitProjects","calculateAllProjectsHealth","error","err","console","getAvailableManagers","users","log","length","warn","id","name","role","filter","p","isManager","projectManager","assignedToStage","stages","some","s","assignedTeamMembers","u","assignedToTask","tasks","t","isAssigned","getIcon","bypassSecurityTrustHtml","navigateTo","view","projectId","selectProject","project","toggleDarkMode","document","documentElement","classList","add","remove","showTaskCreationModal","selectedStageForTask","newTaskName","newTaskStartDate","newTaskEndDate","openTaskCreationModal","stage","closeTaskCreationModal","createTask","taskData","startDate","Date","endDate","isCompleted","addTaskToStage","task","toggleTask","canToggleTask","updates","updateTask","updatedTask","find","isStageLocked","toggleStageSection","isOpen","index","findIndex","prevStage","label","allCompleted","every","getFilteredProjects","platform","getStats","total","completed","status","COMPLETED","inProgress","IN_PROGRESS","lagging","LAGGING","openAssignmentModal","map","closeAssignmentModal","toggleUserSelection","userId","indexOf","splice","push","saveAssignments","assignUsersToStage","updatedStage","stageIndex","undefined","isUserAssigned","includes","canEditStage","getTaskStatus","today","color","sevenDaysFromNow","setDate","getDate","forEach","AT_RISK","sColor","allDone","getStatusBadgeClass","classes","green","yellow","red","blue","gray","getProgressBarColorClass","getUserAvatar","avatar","getUserName","__decorate","selector","templateUrl","styleUrls"],"sources":["/home/deevan/cdl-project-management-system/frontend/src/app/user/user-dashboard/user-dashboard.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { DomSanitizer, SafeHtml } from '@angular/platform-browser';\nimport { Router } from '@angular/router';\nimport { ProjectService } from '../../shared/services/project.service';\nimport { Project, ProjectStatus } from '../../shared/models/project.model';\nimport { User } from '../../shared/models/user.model';\nimport { AuthService } from '../../shared/services/auth.service';\n\n@Component({\n  selector: 'app-user-dashboard',\n  templateUrl: './user-dashboard.component.html',\n  styleUrls: ['./user-dashboard.component.css']\n})\nexport class UserDashboardComponent implements OnInit {\n  // State variables\n  isDarkMode = false;\n  currentView: 'home' | 'flame' | 'swayam' | 'profile' | 'settings' | 'notifications' | 'messages' = 'home';\n\n  // Data\n  currentUser: User | null = null;\n  allProjects: Project[] = [];\n  managedProjects: Project[] = [];\n  assignedProjects: Project[] = [];\n  selectedProject: Project | null = null;\n\n  // Assignment UI\n  availableUsers: User[] = [];\n  showAssignmentModal = false;\n  selectedStageForAssignment: any = null;\n  selectedUsersForAssignment: string[] = [];\n\n  // Icons\n  private ICONS_SVG: { [key: string]: string } = {\n    home: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5\"><path d=\"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\"></path><polyline points=\"9 22 9 12 15 12 15 22\"></polyline></svg>`,\n    user: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5\"><path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"></path><circle cx=\"12\" cy=\"7\" r=\"4\"></circle></svg>`,\n    settings: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5\"><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06-.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"></path></svg>`,\n    bell: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5\"><path d=\"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9\"></path><path d=\"M13.73 21a2 2 0 0 1-3.46 0\"></path></svg>`,\n    message: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5\"><path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path></svg>`,\n    logout: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5\"><path d=\"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4\"></path><polyline points=\"16 17 21 12 16 7\"></polyline><line x1=\"21\" y1=\"12\" x2=\"9\" y2=\"12\"></line></svg>`,\n    sun: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5\"><circle cx=\"12\" cy=\"12\" r=\"5\"></circle><line x1=\"12\" y1=\"1\" x2=\"12\" y2=\"3\"></line><line x1=\"12\" y1=\"21\" x2=\"12\" y2=\"23\"></line><line x1=\"4.22\" y1=\"4.22\" x2=\"5.64\" y2=\"5.64\"></line><line x1=\"18.36\" y1=\"18.36\" x2=\"19.78\" y2=\"19.78\"></line><line x1=\"1\" y1=\"12\" x2=\"3\" y2=\"12\"></line><line x1=\"21\" y1=\"12\" x2=\"23\" y2=\"12\"></line><line x1=\"4.22\" y1=\"19.78\" x2=\"5.64\" y2=\"18.36\"></line><line x1=\"18.36\" y1=\"5.64\" x2=\"19.78\" y2=\"4.22\"></line></svg>`,\n    moon: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5\"><path d=\"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z\"></path></svg>`,\n    chevronLeft: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-6 h-6 text-gray-600 dark:text-gray-300\"><polyline points=\"15 18 9 12 15 6\"></polyline></svg>`,\n    chevronRight: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-6 h-6 text-gray-600 dark:text-gray-300\"><polyline points=\"9 18 15 12 9 6\"></polyline></svg>`,\n    chevronDown: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-5 h-5 text-gray-500\"><polyline points=\"6 9 12 15 18 9\"></polyline></svg>`\n  };\n\n  constructor(\n    private sanitizer: DomSanitizer,\n    private projectService: ProjectService,\n    private router: Router,\n    private authService: AuthService\n  ) { }\n\n  logout() {\n    this.authService.logout();\n    this.router.navigateByUrl('/auth/login');\n  }\n\n  ngOnInit() {\n    this.loadUser();\n    this.loadProjects();\n    this.loadAvailableUsers();\n  }\n\n  loadUser() {\n    this.authService.currentUser.subscribe(user => {\n      if (user) {\n        this.currentUser = user;\n      } else {\n        this.router.navigate(['/auth/login']);\n      }\n    });\n  }\n\n  loadProjects() {\n    if (!this.currentUser) return;\n\n    // Fetch ALL projects for transparency as requested\n    this.projectService.getAllProjectsForDashboard().subscribe({\n      next: (projects) => {\n        this.allProjects = projects;\n        this.splitProjects();\n        this.calculateAllProjectsHealth();\n      },\n      error: (err) => console.error('Failed to load projects', err)\n    });\n  }\n\n  loadAvailableUsers() {\n    this.projectService.getAvailableManagers().subscribe({\n      next: (users) => {\n        this.availableUsers = users;\n        console.log('Loaded available users for assignment:', this.availableUsers.length);\n      },\n      error: (err) => console.error('Failed to load users', err)\n    });\n  }\n\n  splitProjects() {\n    if (!this.currentUser) {\n      console.warn('splitProjects: No currentUser found');\n      return;\n    }\n\n    console.log('splitProjects: Current User:', this.currentUser.id, this.currentUser.name, this.currentUser.role);\n    console.log('splitProjects: All Projects:', this.allProjects.length);\n\n    // Managed Projects: Where user is the Project Manager\n    this.managedProjects = this.allProjects.filter(p => {\n      const isManager = p.projectManager?.id === this.currentUser?.id;\n      if (isManager) console.log(`Project ${p.name} is MANAGED by user`);\n      return isManager;\n    });\n\n    // Assigned Projects: Where user is assigned to stages or tasks (but not PM)\n    this.assignedProjects = this.allProjects.filter(p => {\n      if (p.projectManager?.id === this.currentUser?.id) return false; // Skip if PM\n\n      // Check if assigned to any stage\n      const assignedToStage = p.stages?.some(s =>\n        s.assignedTeamMembers?.some(u => u.id === this.currentUser?.id)\n      );\n\n      // Check if assigned to any task\n      const assignedToTask = p.stages?.some(s =>\n        s.tasks?.some(t =>\n          t.assignedTeamMembers?.some(u => u.id === this.currentUser?.id)\n        )\n      );\n\n      const isAssigned = assignedToStage || assignedToTask;\n      if (isAssigned) console.log(`Project ${p.name} is ASSIGNED to user`);\n      return isAssigned;\n    });\n\n    console.log('Managed Projects Count:', this.managedProjects.length);\n    console.log('Assigned Projects Count:', this.assignedProjects.length);\n  }\n\n  // --- UI Actions ---\n\n  getIcon(name: string): SafeHtml {\n    return this.sanitizer.bypassSecurityTrustHtml(this.ICONS_SVG[name] || '');\n  }\n\n  navigateTo(view: string, projectId?: string) {\n    if (projectId) {\n      this.router.navigate(['/projects', projectId]);\n      return;\n    }\n    this.currentView = view as any;\n  }\n\n  selectProject(project: Project) {\n    this.selectedProject = project;\n  }\n\n  toggleDarkMode() {\n    this.isDarkMode = !this.isDarkMode;\n    if (this.isDarkMode) {\n      document.documentElement.classList.add('dark');\n    } else {\n      document.documentElement.classList.remove('dark');\n    }\n  }\n\n  // --- Task Creation UI ---\n  showTaskCreationModal = false;\n  selectedStageForTask: any = null;\n  newTaskName = '';\n  newTaskStartDate = '';\n  newTaskEndDate = '';\n\n  openTaskCreationModal(stage: any) {\n    this.selectedStageForTask = stage;\n    this.newTaskName = '';\n    this.newTaskStartDate = '';\n    this.newTaskEndDate = '';\n    this.showTaskCreationModal = true;\n  }\n\n  closeTaskCreationModal() {\n    this.showTaskCreationModal = false;\n    this.selectedStageForTask = null;\n  }\n\n  createTask() {\n    if (!this.selectedStageForTask || !this.newTaskName || !this.newTaskStartDate || !this.newTaskEndDate) return;\n\n    const taskData = {\n      name: this.newTaskName,\n      startDate: new Date(this.newTaskStartDate),\n      endDate: new Date(this.newTaskEndDate),\n      isCompleted: false\n    };\n\n    this.projectService.addTaskToStage(this.selectedStageForTask.id, taskData).subscribe({\n      next: (task) => {\n        // Refresh project\n        this.loadProjects();\n        this.closeTaskCreationModal();\n      },\n      error: (err) => console.error('Failed to create task', err)\n    });\n  }\n\n  // --- Task Toggle ---\n\n  toggleTask(task: any) {\n    if (!this.canToggleTask(task)) return;\n\n    const updates = { isCompleted: !task.isCompleted };\n    this.projectService.updateTask(task.id, updates).subscribe({\n      next: (updatedTask) => {\n        task.isCompleted = updatedTask.isCompleted;\n        this.calculateAllProjectsHealth();\n      },\n      error: (err) => {\n        console.error('Failed to update task', err);\n        // Revert if failed\n        task.isCompleted = !task.isCompleted;\n      }\n    });\n  }\n\n  canToggleTask(task: any): boolean {\n    // PM can always toggle\n    if (this.selectedProject?.projectManager?.id === this.currentUser?.id) return true;\n\n    // Find stage for this task\n    const stage = this.selectedProject?.stages?.find(s => s.tasks?.some((t: any) => t.id === task.id));\n    if (!stage) return false;\n\n    // Check if stage is locked\n    if (this.isStageLocked(stage)) return false;\n\n    // Assigned users can toggle\n    return stage.assignedTeamMembers?.some((u: User) => u.id === this.currentUser?.id);\n  }\n\n  toggleStageSection(stage: any) {\n    if (this.isStageLocked(stage)) return;\n    stage.isOpen = !stage.isOpen;\n  }\n\n  isStageLocked(stage: any): boolean {\n    if (!this.selectedProject || !this.selectedProject.stages) return false;\n\n    const index = this.selectedProject.stages.findIndex(s => s.id === stage.id);\n    if (index <= 0) return false; // First stage always unlocked\n\n    // Check previous stage\n    const prevStage = this.selectedProject.stages[index - 1];\n    // Ideally check status, but for now check if all tasks are completed\n    // Or use the status from backend if reliable\n    // Let's use a simple check: is previous stage completed?\n    // If backend status is COMPLETED, then yes.\n    // If not, check tasks manually\n    if ((prevStage as any)['status']?.label === 'Completed') return false;\n\n    // Manual check\n    if (!prevStage.tasks || prevStage.tasks.length === 0) return false; // If no tasks, assume done? Or blocked? Let's say unlocked if empty for now to avoid deadlocks\n\n    const allCompleted = prevStage.tasks.every((t: any) => t.isCompleted);\n    return !allCompleted;\n  }\n\n  getFilteredProjects(platform: string): Project[] {\n    return this.allProjects.filter(p => p.platform === platform);\n  }\n\n  getStats() {\n    return {\n      total: this.allProjects.length,\n      completed: this.allProjects.filter(p => p.status === ProjectStatus.COMPLETED).length,\n      inProgress: this.allProjects.filter(p => p.status === ProjectStatus.IN_PROGRESS).length,\n      lagging: this.allProjects.filter(p => p.status === ProjectStatus.LAGGING).length\n    };\n  }\n\n  // --- Assignment Logic ---\n\n  openAssignmentModal(stage: any) {\n    this.selectedStageForAssignment = stage;\n    this.selectedUsersForAssignment = stage.assignedTeamMembers?.map((u: User) => u.id) || [];\n    this.showAssignmentModal = true;\n  }\n\n  closeAssignmentModal() {\n    this.showAssignmentModal = false;\n    this.selectedStageForAssignment = null;\n    this.selectedUsersForAssignment = [];\n  }\n\n  toggleUserSelection(userId: string) {\n    const index = this.selectedUsersForAssignment.indexOf(userId);\n    if (index > -1) {\n      this.selectedUsersForAssignment.splice(index, 1);\n    } else {\n      this.selectedUsersForAssignment.push(userId);\n    }\n  }\n\n  saveAssignments() {\n    if (!this.selectedStageForAssignment) return;\n\n    this.projectService.assignUsersToStage(this.selectedStageForAssignment.id, this.selectedUsersForAssignment).subscribe({\n      next: (updatedStage) => {\n        // Update local state\n        const stageIndex = this.selectedProject?.stages?.findIndex(s => s.id === updatedStage.id);\n        if (this.selectedProject && stageIndex !== undefined && stageIndex > -1) {\n          // Refresh project to get full user objects\n          this.loadProjects();\n        }\n        this.closeAssignmentModal();\n      },\n      error: (err) => console.error('Failed to assign users', err)\n    });\n  }\n\n  isUserAssigned(userId: string): boolean {\n    return this.selectedUsersForAssignment.includes(userId);\n  }\n\n  canEditStage(stage: any): boolean {\n    if (!this.currentUser) return false;\n    // PM can always edit\n    if (this.selectedProject?.projectManager?.id === this.currentUser.id) return true;\n    return false; // Only PM can edit structure (add tasks, assign users)\n  }\n\n  // --- Helpers ---\n\n  getTaskStatus(task: any) {\n    const endDate = new Date(task.endDate);\n    const today = new Date();\n    if (task.isCompleted) return { label: 'Completed', color: 'green' };\n    if (endDate < today) return { label: 'Overdue', color: 'red' };\n\n    const sevenDaysFromNow = new Date();\n    sevenDaysFromNow.setDate(today.getDate() + 7);\n\n    if (endDate <= sevenDaysFromNow) return { label: 'At-Risk', color: 'yellow' };\n    return { label: 'On Track', color: 'green' };\n  }\n\n  calculateAllProjectsHealth() {\n    // Use backend values if available, or calculate locally\n    // For now, relying on backend 'overallProgress' and 'status'\n    this.allProjects.forEach(p => {\n      // Map backend status to UI colors\n      let color = 'blue';\n      if (p.status === ProjectStatus.COMPLETED) color = 'green';\n      if (p.status === ProjectStatus.LAGGING) color = 'red';\n      if (p.status === ProjectStatus.AT_RISK) color = 'yellow';\n\n      (p as any)['overallStatus'] = { label: p.status, color };\n\n      // Stage status\n      p.stages?.forEach(stage => {\n        let sColor = 'blue';\n        // map stage status...\n        // Check tasks\n        if (stage.tasks && stage.tasks.length > 0) {\n          const allDone = stage.tasks.every((t: any) => t.isCompleted);\n          if (allDone) {\n            (stage as any)['status'] = { label: 'Completed', color: 'green' };\n          } else {\n            (stage as any)['status'] = { label: 'In Progress', color: 'blue' };\n          }\n        } else {\n          (stage as any)['status'] = { label: 'Pending', color: 'gray' };\n        }\n      });\n    });\n  }\n\n  getStatusBadgeClass(color: string | undefined): string {\n    const classes: { [key: string]: string } = {\n      green: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300',\n      yellow: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300',\n      red: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300',\n      blue: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300',\n      gray: 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300'\n    };\n    return `px-2.5 py-0.5 text-xs font-medium rounded-full ${classes[color || 'blue']}`;\n  }\n\n  getProgressBarColorClass(color: string | undefined): string {\n    const classes: { [key: string]: string } = {\n      green: 'bg-green-500',\n      yellow: 'bg-yellow-500',\n      red: 'bg-red-500',\n      blue: 'bg-blue-500',\n      gray: 'bg-gray-500'\n    };\n    return classes[color || 'blue'];\n  }\n\n  getUserAvatar(user: User | undefined): string {\n    return user?.avatar || 'assets/default-avatar.png';\n  }\n\n  getUserName(user: User | undefined): string {\n    return user?.name || 'Unknown';\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}